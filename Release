node ('master') {
   stage('Release') {
      withCredentials([[$class: 'UsernamePasswordMultiBinding', credentialsId: 'tower', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']]) {
       sh 'tower-cli config host tower.andyneeb.com && tower-cli config verify_ssl false && tower-cli config username $USERNAME && tower-cli config password $PASSWORD'
       }
      sh 'tower-cli job_template create --name "Release Demo App v$(lastversion andyneeb/ansible-demo-app)" --project "Demo App Repo" --playbook "plays/simple.yml" --inventory "OpenStack Prod" --extra-vars=app_release=$(lastversion andyneeb/ansible-demo-app) --extra-vars=app_stage=release --ask-limit-on-launch TRUE --credential "RHEL Cloud User Secure"'
      sh 'tower-cli role grant --type "execute" --user "release_manager" --job-template "Release Demo App v$(lastversion andyneeb/ansible-demo-app)"'
      sh 'tower-cli job_template delete --name "Release Demo App v$(bc <<< $(lastversion andyneeb/ansible-demo-app)-0.2)"'
     }
}
